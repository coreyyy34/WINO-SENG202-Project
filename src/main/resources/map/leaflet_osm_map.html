<!DOCTYPE html>
<html lang="en">
    <head>
        <title>WINO Map</title>
        <link
            href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
            rel="stylesheet"
        />
        <link
            href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"
            rel="stylesheet"
        />
        <link
            href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
            rel="stylesheet"
        />
        <meta content="initial-scale=1.0" name="viewport" />
        <meta charset="utf-8" />
        <style>
            html,
            body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #map {
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <!-- https://leafletjs.com/ -->
        <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>

        <!-- https://github.com/Leaflet/Leaflet.markercluster -->
        <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

        <!-- https://github.com/pa7/heatmap.js -->
        <script src="https://unpkg.com/heatmap.js@2.0.5/build/heatmap.min.js"></script>
        <script src="https://unpkg.com/heatmap.js@2.0.5/plugins/leaflet-heatmap/leaflet-heatmap.js"></script>

        <script>
            const TILE_SERVER_URL =
                "https://tile.csse.canterbury.ac.nz/hot/{z}/{x}/{y}.png";
            const TILE_SERVER_ATTRIBUTION =
                "Â© OpenStreetMap contributors<br>Served by University of Canterbury";

            const HEATMAP_CONFIG = {
                radius: 0.5,
                scaleRadius: true,
                maxOpacity: 0.4,
                latField: "lat",
                lngField: "lon",
            };

            const MAP_CONFIG = {
                center: [-44.0, 171.0],
                zoom: 6,
            };

            const WINE_ICON = L.icon({
                iconUrl: "wine_glass_small.png",
                iconSize: [36, 60],
                iconAnchor: [24, 40],
                popupAnchor: [0, -40],
            });

            let map, markersLayer, heatMapLayer;
            const markers = [];
            let heatMapData = [];

            const jsConnector = {
                initMap: initMap,
            };

            function initMap() {
                map = new L.map("map", MAP_CONFIG);
                new L.TileLayer(TILE_SERVER_URL, {
                    attribution: TILE_SERVER_ATTRIBUTION,
                }).addTo(map);

                // Marker Clusters - Combines nearby markers into 1
                markersLayer = L.markerClusterGroup({});
                map.addLayer(markersLayer);

                // Heatmap
                // heatMapLayer = new HeatmapOverlay(HEATMAP_CONFIG);
                // map.addLayer(heatMapLayer);
                // heatMapLayer.setData({ data: heatMapData }, TEST_DATA);
            }

            function addWineMarker(latitude, longitude, locationName = null) {
                const marker = L.marker([latitude, longitude], {
                    icon: WINE_ICON,
                    riseOnHover: true,
                });
                if (locationName) {
                    marker.bindPopup(
                        `Name: WineName<br>
                    Type: WineType<br>
                    Location: ${locationName}`
                    );
                }
                markers.push(marker);
                markersLayer.addLayer(marker);
                heatMapData.push({ lat: latitude, lon: longitude });
            }
        </script>
    </body>
</html>
